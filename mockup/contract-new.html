<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ê³„ì•½ ë“±ë¡ - MsspBizCenter</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Navbar -->
    <nav class="bg-indigo-600 text-white">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-6">
                    <a href="index.html" class="text-xl font-bold">ğŸ </a>
                    <a href="tasks.html" class="hover:text-indigo-200">ì—…ë¬´ ì¼ì§€</a>
                    <a href="meetings.html" class="hover:text-indigo-200">íšŒì˜ë¡</a>
                    <a href="contracts.html" class="font-bold border-b-2">ê³„ì•½ ê´€ë¦¬</a>
                    <a href="settings.html" class="hover:text-indigo-200">âš™ï¸ ì„¤ì •</a>
                </div>
                <div class="flex items-center gap-4">
                    <span>ê´€ë¦¬ì</span>
                    <button class="hover:text-indigo-200">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-5xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold">ìƒˆ ê³„ì•½ ë“±ë¡</h1>
            <a href="contracts.html" class="text-gray-600 hover:text-gray-800">â† ëª©ë¡ìœ¼ë¡œ</a>
        </div>

        <!-- Security Notice -->
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-amber-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <div>
                    <h3 class="font-bold text-amber-800">ë³´ì•ˆ ì•ˆë‚´</h3>
                    <p class="text-sm text-amber-700 mt-1">
                        ê³„ì•½ ê¸ˆì•¡ì€ AES-256-GCM ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
                        Owner/Admin ê¶Œí•œë§Œ ë³µí˜¸í™”ëœ ê¸ˆì•¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form class="bg-white rounded-lg shadow p-6 space-y-6">
            <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ê¸°ë³¸ ì •ë³´</h2>

                <!-- ê³„ì•½ëª… -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ê³„ì•½ëª… <span class="text-red-500">*</span>
                    </label>
                    <input
                        type="text"
                        class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                        placeholder="ì˜ˆ: ë³´ì•ˆ ì†”ë£¨ì…˜ ë¼ì´ì„ ìŠ¤"
                        required
                    >
                </div>

                <!-- ê³„ì•½ë²ˆí˜¸ & ê³„ì•½ ì—…ì²´ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê³„ì•½ë²ˆí˜¸ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="ì˜ˆ: SVC-2026-001"
                            required
                        >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê³„ì•½ ì—…ì²´ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="ì˜ˆ: ABC ë³´ì•ˆ ì£¼ì‹íšŒì‚¬"
                            required
                        >
                    </div>
                </div>

                <!-- ê³„ì•½ ìœ í˜• -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ê³„ì•½ ìœ í˜• <span class="text-red-500">*</span>
                    </label>
                    <select class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="service">ì„œë¹„ìŠ¤ ê³„ì•½</option>
                        <option value="license">ë¼ì´ì„ ìŠ¤</option>
                        <option value="maintenance">ìœ ì§€ë³´ìˆ˜</option>
                        <option value="consulting">ì»¨ì„¤íŒ…</option>
                        <option value="subscription">êµ¬ë…í˜• ì„œë¹„ìŠ¤</option>
                        <option value="other">ê¸°íƒ€</option>
                    </select>
                </div>
            </div>

            <!-- ê³„ì•½ ê¸°ê°„ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ê³„ì•½ ê¸°ê°„</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê³„ì•½ ì‹œì‘ì¼ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="date"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            value="2026-02-07"
                            required
                        >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê³„ì•½ ì¢…ë£Œì¼ <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="date"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            required
                        >
                    </div>
                </div>

                <!-- ìë™ ê°±ì‹  -->
                <div class="mt-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="w-5 h-5 text-amber-600 rounded focus:ring-2 focus:ring-amber-500">
                        <span class="text-sm font-medium text-gray-700">ìë™ ê°±ì‹  ê³„ì•½</span>
                    </label>
                    <p class="text-xs text-gray-500 ml-7 mt-1">
                        ì²´í¬ ì‹œ ë§Œë£Œì¼ 30ì¼ ì „ ê°±ì‹  ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤
                    </p>
                </div>
            </div>

            <!-- ê¸ˆì•¡ ì •ë³´ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ê¸ˆì•¡ ì •ë³´</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê³„ì•½ ê¸ˆì•¡ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input
                                type="number"
                                class="w-full border border-gray-300 rounded px-4 py-2 pr-12 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                placeholder="0"
                                min="0"
                                step="1000"
                                required
                            >
                            <span class="absolute right-4 top-2.5 text-gray-500">ì›</span>
                        </div>
                        <p class="text-xs text-amber-600 mt-1 flex items-center gap-1">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                            </svg>
                            ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê²°ì œ ì£¼ê¸°
                        </label>
                        <select class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="onetime">ì¼ì‹œë¶ˆ</option>
                            <option value="monthly">ì›”ë‚©</option>
                            <option value="quarterly">ë¶„ê¸°ë‚©</option>
                            <option value="yearly">ì—°ë‚©</option>
                        </select>
                    </div>
                </div>

                <!-- VAT í¬í•¨ ì—¬ë¶€ -->
                <div class="mt-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="w-5 h-5 text-amber-600 rounded focus:ring-2 focus:ring-amber-500" checked>
                        <span class="text-sm font-medium text-gray-700">VAT í¬í•¨ (10%)</span>
                    </label>
                </div>
            </div>

            <!-- ê³µê¸‰ ì œí’ˆ ë° êµ¬ì„± ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ê³µê¸‰ ì œí’ˆ ë° êµ¬ì„±</h2>
                <p class="text-sm text-gray-600 mb-4">ê³„ì•½ì— í¬í•¨ë˜ëŠ” ì œí’ˆê³¼ êµ¬ì„±(ì˜µì…˜)ì„ ì„ íƒí•˜ì„¸ìš”.</p>

                <!-- Product items container -->
                <div id="productItems" class="space-y-4">
                    <!-- Default first item -->
                    <div class="product-item bg-gray-50 border border-gray-300 rounded-lg p-4 relative">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-bold text-gray-800">í•­ëª© 1</h3>
                            <button type="button" class="remove-btn text-red-500 hover:text-red-700 text-xl font-bold hidden" onclick="removeProductItem(this)">âœ•</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ì œí’ˆ</label>
                                <select class="product-select w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" onchange="updateOptions(this)">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="StealthMole">StealthMole</option>
                                    <option value="ThreatRecon">ThreatRecon</option>
                                    <option value="TR Report">TR Report</option>
                                    <option value="deep.insight">deep.insight</option>
                                    <option value="Consulting">Consulting</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ì„±</label>
                                <select class="option-select w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" disabled>
                                    <option value="">ì œí’ˆì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ìˆ˜ëŸ‰</label>
                                <input type="number" class="quantity-input w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" min="1" value="1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ê³ </label>
                                <input type="text" class="note-input w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="ì¶”ê°€ ì •ë³´ ì…ë ¥">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add button -->
                <button type="button" onclick="addProductItem()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 font-medium text-sm">+ ì œí’ˆ ì¶”ê°€</button>
            </div>

            <!-- ì¬ë¬´ ì •ë³´ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ì¬ë¬´ ì •ë³´</h2>
                <p class="text-xs text-amber-600 mb-4 flex items-center gap-1">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                    </svg>
                    Admin ê¶Œí•œ í•„ìš”
                </p>

                <!-- ë§¤ì… ì •ë³´ -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <h3 class="flex items-center gap-2 text-sm font-bold text-blue-900 mb-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ë§¤ì… ì •ë³´
                </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ê¸°ë³¸ ë§¤ì…ê°€
                            </label>
                            <div class="relative">
                                <input
                                    type="number"
                                    id="purchasePrice"
                                    class="w-full border border-gray-300 rounded px-4 py-2 pr-12 focus:ring-2 focus:ring-amber-500 focus:border-transparent bg-white"
                                    placeholder="0"
                                    min="0"
                                    step="1000"
                                    oninput="calculateMargin()"
                                >
                                <span class="absolute right-4 top-2.5 text-gray-500">ì›</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ë§¤ì… ìˆ˜ìˆ˜ë£Œìœ¨
                            </label>
                            <div class="relative">
                                <input
                                    type="number"
                                    id="purchaseCommissionRate"
                                    class="w-full border border-gray-300 rounded px-4 py-2 pr-8 focus:ring-2 focus:ring-amber-500 focus:border-transparent bg-white"
                                    placeholder="0"
                                    min="0"
                                    max="100"
                                    step="0.1"
                                    oninput="calculateMargin()"
                                >
                                <span class="absolute right-4 top-2.5 text-gray-500">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ì˜ˆ: ëŒ€ë¦¬ì  ìˆ˜ìˆ˜ë£Œ</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ì‹¤ì œ ë§¤ì…ê°€
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="actualPurchasePrice"
                                    class="w-full border border-blue-300 rounded px-4 py-2 pr-12 bg-blue-100 font-bold text-blue-800"
                                    placeholder="0"
                                    readonly
                                >
                                <span class="absolute right-4 top-2.5 text-blue-600">ì›</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ìˆ˜ìˆ˜ë£Œ í¬í•¨</p>
                        </div>
                    </div>
                </div>

                <!-- íŒë§¤ ì •ë³´ -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                    <h3 class="flex items-center gap-2 text-sm font-bold text-green-900 mb-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                    </svg>
                    íŒë§¤ ì •ë³´
                </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ê¸°ë³¸ íŒë§¤ê°€
                            </label>
                            <div class="relative">
                                <input
                                    type="number"
                                    id="salesPrice"
                                    class="w-full border border-gray-300 rounded px-4 py-2 pr-12 focus:ring-2 focus:ring-amber-500 focus:border-transparent bg-white"
                                    placeholder="0"
                                    min="0"
                                    step="1000"
                                    oninput="calculateMargin()"
                                >
                                <span class="absolute right-4 top-2.5 text-gray-500">ì›</span>
                            </div>
                        </div>

                        <div>
                            <label class="flex items-center gap-2 mb-2">
                                <input
                                    type="checkbox"
                                    id="hasPartner"
                                    class="w-4 h-4 text-green-600 rounded focus:ring-2 focus:ring-green-500"
                                    onchange="togglePartnerSection()"
                                >
                                <span class="text-sm font-medium text-gray-700">íŒŒíŠ¸ë„ˆì‚¬ í¬í•¨</span>
                            </label>
                            <p class="text-xs text-gray-500">íŒŒíŠ¸ë„ˆì‚¬ë¥¼ í†µí•œ ê³„ì•½ì¸ ê²½ìš° ì²´í¬í•˜ì„¸ìš”</p>
                        </div>
                    </div>

                    <!-- íŒŒíŠ¸ë„ˆ ìˆ˜ìˆ˜ë£Œ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
                    <div id="partnerSection" class="hidden border-t border-green-300 pt-3">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    íŒŒíŠ¸ë„ˆì‚¬ëª…
                                </label>
                                <input
                                    type="text"
                                    id="partnerName"
                                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white"
                                    placeholder="íŒŒíŠ¸ë„ˆì‚¬ ì´ë¦„"
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ìˆ˜ìˆ˜ë£Œ ë°©ì‹
                                </label>
                                <select
                                    id="partnerCommissionType"
                                    class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white"
                                    onchange="calculateMargin()"
                                >
                                    <option value="rate">ë¹„ìœ¨ (%)</option>
                                    <option value="amount">ê¸ˆì•¡ (ì›)</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    íŒŒíŠ¸ë„ˆ ìˆ˜ìˆ˜ë£Œ
                                </label>
                                <div class="relative">
                                    <input
                                        type="number"
                                        id="partnerCommission"
                                        class="w-full border border-gray-300 rounded px-4 py-2 pr-12 focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white"
                                        placeholder="0"
                                        min="0"
                                        step="0.1"
                                        oninput="calculateMargin()"
                                    >
                                    <span class="absolute right-4 top-2.5 text-gray-500" id="partnerCommissionUnit">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì‹¤ì œ íŒë§¤ê°€ (ìˆ˜ë ¹ì•¡)
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="actualSalesPrice"
                                class="w-full border border-green-300 rounded px-4 py-2 pr-12 bg-green-100 font-bold text-green-800"
                                placeholder="0"
                                readonly
                            >
                            <span class="absolute right-4 top-2.5 text-green-600">ì›</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">íŒŒíŠ¸ë„ˆ ìˆ˜ìˆ˜ë£Œ ì°¨ê° í›„</p>
                    </div>
                </div>

                <!-- ìµœì¢… ë§ˆì§„ -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="flex items-center gap-2 text-sm font-bold text-purple-900 mb-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                    </svg>
                    ìµœì¢… ë§ˆì§„ìœ¨
                </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ê¸°ë³¸ ë§ˆì§„ìœ¨
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="basicMarginRate"
                                    class="w-full border border-gray-300 rounded px-4 py-2 pr-8 bg-gray-100 text-gray-700"
                                    placeholder="-"
                                    readonly
                                >
                                <span class="absolute right-4 top-2.5 text-gray-500">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ìˆ˜ìˆ˜ë£Œ ë¯¸ë°˜ì˜</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ì‹¤ì œ ë§ˆì§„ìœ¨
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="actualMarginRate"
                                    class="w-full border border-purple-300 rounded px-4 py-2 pr-8 bg-purple-100 font-bold text-lg"
                                    placeholder="-"
                                    readonly
                                >
                                <span class="absolute right-4 top-2.5 text-purple-600">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ëª¨ë“  ìˆ˜ìˆ˜ë£Œ ë°˜ì˜</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ì‹¤ì œ ë§ˆì§„ì•¡
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="actualMarginAmount"
                                    class="w-full border border-purple-300 rounded px-4 py-2 pr-12 bg-purple-100 font-bold"
                                    placeholder="0"
                                    readonly
                                >
                                <span class="absolute right-4 top-2.5 text-purple-600">ì›</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ì‹¤ì œ ìˆ˜ë ¹ - ì‹¤ì œ ë§¤ì…</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‹´ë‹¹ì ì •ë³´ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ë‹´ë‹¹ì ì •ë³´</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì‚¬ë‚´ ë‹´ë‹¹ì
                        </label>
                        <select class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë°•ì„œì—°">ğŸ‘¤ ë°•ì„œì—° (PM)</option>
                            <option value="ë°•ì•ˆë„">ğŸ‘¤ ë°•ì•ˆë„ (Backend)</option>
                            <option value="ë°°í¬ì¤€">ğŸ‘¤ ë°°í¬ì¤€ (DevOps)</option>
                            <option value="Chloe">ğŸ‘¤ Chloe (Security)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì—…ì²´ ë‹´ë‹¹ìëª…
                        </label>
                        <input
                            type="text"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="ì˜ˆ: í™ê¸¸ë™ (ì˜ì—…íŒ€ ë¶€ì¥)"
                        >
                    </div>
                </div>

                <!-- ì—…ì²´ ì—°ë½ì²˜ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì—…ì²´ ì—°ë½ì²˜
                        </label>
                        <input
                            type="tel"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="ì˜ˆ: 02-1234-5678"
                        >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì—…ì²´ ì´ë©”ì¼
                        </label>
                        <input
                            type="email"
                            class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="ì˜ˆ: contact@company.com"
                        >
                    </div>
                </div>
            </div>

            <!-- ì•Œë¦¼ ì„¤ì • ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ì•Œë¦¼ ì„¤ì •</h2>

                <div class="space-y-3">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="w-5 h-5 text-amber-600 rounded focus:ring-2 focus:ring-amber-500" checked>
                        <span class="text-sm text-gray-700">ë§Œë£Œ 30ì¼ ì „ ì•Œë¦¼</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="w-5 h-5 text-amber-600 rounded focus:ring-2 focus:ring-amber-500" checked>
                        <span class="text-sm text-gray-700">ë§Œë£Œ 7ì¼ ì „ ì•Œë¦¼</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" class="w-5 h-5 text-amber-600 rounded focus:ring-2 focus:ring-amber-500">
                        <span class="text-sm text-gray-700">ë§Œë£Œì¼ ë‹¹ì¼ ì•Œë¦¼</span>
                    </label>
                </div>
            </div>

            <!-- ì¶”ê°€ ì •ë³´ ì„¹ì…˜ -->
            <div class="border-b pb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ì¶”ê°€ ì •ë³´</h2>

                <!-- ì„¤ëª… -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ê³„ì•½ ì„¤ëª…
                    </label>
                    <textarea
                        rows="4"
                        class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                        placeholder="ê³„ì•½ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì˜ˆì‹œ:&#10;â€¢ ì œê³µ ì„œë¹„ìŠ¤ ë‚´ìš©&#10;â€¢ íŠ¹ì´ì‚¬í•­&#10;â€¢ ê³„ì•½ ì¡°ê±´ ë“±"
                    ></textarea>
                </div>

                <!-- ë©”ëª¨ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ë©”ëª¨
                    </label>
                    <textarea
                        rows="3"
                        class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                        placeholder="ë‚´ë¶€ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)"
                    ></textarea>
                </div>

                <!-- ì²¨ë¶€íŒŒì¼ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ê³„ì•½ì„œ ì²¨ë¶€
                    </label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">ê³„ì•½ì„œ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                        <input type="file" class="hidden" accept=".pdf,.doc,.docx" multiple>
                        <button type="button" class="mt-2 text-amber-600 hover:text-amber-800 text-sm">íŒŒì¼ ì„ íƒ</button>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-4">
                <button
                    type="submit"
                    class="bg-amber-600 text-white px-6 py-2 rounded hover:bg-amber-700 font-medium"
                >
                    ê³„ì•½ ë“±ë¡
                </button>
                <a
                    href="contracts.html"
                    class="bg-gray-200 text-gray-700 px-6 py-2 rounded hover:bg-gray-300 font-medium"
                >
                    ì·¨ì†Œ
                </a>
            </div>
        </form>
    </div>

    <script>
        // Toggle partner section visibility
        function togglePartnerSection() {
            const hasPartner = document.getElementById('hasPartner').checked;
            const partnerSection = document.getElementById('partnerSection');

            if (hasPartner) {
                partnerSection.classList.remove('hidden');
            } else {
                partnerSection.classList.add('hidden');
                // Reset partner fields
                document.getElementById('partnerName').value = '';
                document.getElementById('partnerCommission').value = '';
            }

            calculateMargin();
        }

        // Update partner commission unit when type changes
        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.getElementById('partnerCommissionType');
            typeSelect.addEventListener('change', function() {
                const unit = document.getElementById('partnerCommissionUnit');
                unit.textContent = this.value === 'rate' ? '%' : 'ì›';
                calculateMargin();
            });
        });

        // Calculate all margins and prices
        function calculateMargin() {
            // Get input values
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const purchaseCommissionRate = parseFloat(document.getElementById('purchaseCommissionRate').value) || 0;
            const salesPrice = parseFloat(document.getElementById('salesPrice').value) || 0;
            const hasPartner = document.getElementById('hasPartner').checked;
            const partnerCommissionType = document.getElementById('partnerCommissionType').value;
            const partnerCommission = parseFloat(document.getElementById('partnerCommission').value) || 0;

            // Calculate actual purchase price (ë§¤ì…ê°€ + ìˆ˜ìˆ˜ë£Œ)
            const actualPurchasePrice = purchasePrice * (1 + purchaseCommissionRate / 100);
            document.getElementById('actualPurchasePrice').value = actualPurchasePrice.toLocaleString('ko-KR', { maximumFractionDigits: 0 });

            // Calculate partner commission amount
            let partnerCommissionAmount = 0;
            if (hasPartner && partnerCommission > 0) {
                if (partnerCommissionType === 'rate') {
                    partnerCommissionAmount = salesPrice * (partnerCommission / 100);
                } else {
                    partnerCommissionAmount = partnerCommission;
                }
            }

            // Calculate actual sales price (íŒë§¤ê°€ - íŒŒíŠ¸ë„ˆ ìˆ˜ìˆ˜ë£Œ)
            const actualSalesPrice = salesPrice - partnerCommissionAmount;
            document.getElementById('actualSalesPrice').value = actualSalesPrice.toLocaleString('ko-KR', { maximumFractionDigits: 0 });

            // Calculate basic margin rate (ê¸°ë³¸ ë§ˆì§„ìœ¨ - ìˆ˜ìˆ˜ë£Œ ë¯¸ë°˜ì˜)
            const basicMarginRateField = document.getElementById('basicMarginRate');
            if (salesPrice > 0) {
                const basicMargin = ((salesPrice - purchasePrice) / salesPrice) * 100;
                basicMarginRateField.value = basicMargin.toFixed(2);
                applyMarginColor(basicMarginRateField, basicMargin);
            } else {
                basicMarginRateField.value = '-';
                basicMarginRateField.classList.remove('text-red-600', 'text-green-600', 'text-amber-600');
            }

            // Calculate actual margin rate (ì‹¤ì œ ë§ˆì§„ìœ¨ - ëª¨ë“  ìˆ˜ìˆ˜ë£Œ ë°˜ì˜)
            const actualMarginRateField = document.getElementById('actualMarginRate');
            const actualMarginAmountField = document.getElementById('actualMarginAmount');

            if (actualSalesPrice > 0) {
                const actualMargin = ((actualSalesPrice - actualPurchasePrice) / actualSalesPrice) * 100;
                const actualMarginAmount = actualSalesPrice - actualPurchasePrice;

                actualMarginRateField.value = actualMargin.toFixed(2);
                actualMarginAmountField.value = actualMarginAmount.toLocaleString('ko-KR', { maximumFractionDigits: 0 });

                applyMarginColor(actualMarginRateField, actualMargin);
            } else {
                actualMarginRateField.value = '-';
                actualMarginAmountField.value = '0';
                actualMarginRateField.classList.remove('text-red-600', 'text-green-600', 'text-amber-600');
            }
        }

        // Apply color based on margin percentage
        function applyMarginColor(field, margin) {
            if (margin < 0) {
                field.classList.add('text-red-600');
                field.classList.remove('text-green-600', 'text-amber-600');
            } else if (margin >= 20) {
                field.classList.add('text-green-600');
                field.classList.remove('text-red-600', 'text-amber-600');
            } else {
                field.classList.add('text-amber-600');
                field.classList.remove('text-red-600', 'text-green-600');
            }
        }

        // Format number with commas
        function formatNumber(value) {
            return value.toLocaleString('ko-KR', { maximumFractionDigits: 0 });
        }

        // ========== Product Items Management ==========

        // Product options data
        const productOptionsData = {
            'StealthMole': ['DT (Dark Tracer)', 'TT (Threat Tracer)', 'CDS (Credential Detection Service)'],
            'ThreatRecon': ['Platform (í”Œë«í¼)', 'API (API ì—°ë™)', 'RFI (Request for Intelligence)'],
            'TR Report': ['Monthly (ì›”ê°„ ë¦¬í¬íŠ¸)', 'Ad-hoc (ê±´ë³„ ë¦¬í¬íŠ¸)', 'Custom (ë§ì¶¤ ë¦¬í¬íŠ¸)'],
            'deep.insight': ['Basic (ê¸°ë³¸ ë¶„ì„)', 'Advanced (ì‹¬ì¸µ ë¶„ì„)', 'Premium (í”„ë¦¬ë¯¸ì—„ ë¶„ì„)'],
            'Consulting': ['Assessment (ë³´ì•ˆ í‰ê°€)', 'Advisory (ìë¬¸)', 'Training (êµìœ¡)']
        };

        let productItemCounter = 1;

        // Add a new product item
        function addProductItem() {
            productItemCounter++;
            const container = document.getElementById('productItems');

            // Create new product item
            const newItem = document.createElement('div');
            newItem.className = 'product-item bg-gray-50 border border-gray-300 rounded-lg p-4 relative';
            newItem.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-bold text-gray-800">í•­ëª© ${productItemCounter}</h3>
                    <button type="button" class="remove-btn text-red-500 hover:text-red-700 text-xl font-bold" onclick="removeProductItem(this)">âœ•</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì œí’ˆ</label>
                        <select class="product-select w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" onchange="updateOptions(this)">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="StealthMole">StealthMole</option>
                            <option value="ThreatRecon">ThreatRecon</option>
                            <option value="TR Report">TR Report</option>
                            <option value="deep.insight">deep.insight</option>
                            <option value="Consulting">Consulting</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ì„±</label>
                        <select class="option-select w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" disabled>
                            <option value="">ì œí’ˆì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìˆ˜ëŸ‰</label>
                        <input type="number" class="quantity-input w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" min="1" value="1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ê³ </label>
                        <input type="text" class="note-input w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="ì¶”ê°€ ì •ë³´ ì…ë ¥">
                    </div>
                </div>
            `;

            container.appendChild(newItem);
            updateRemoveButtons();
        }

        // Remove a product item
        function removeProductItem(button) {
            const items = document.querySelectorAll('.product-item');

            // Keep at least 1 item
            if (items.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ì œí’ˆ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            // Remove the item
            button.closest('.product-item').remove();

            // Renumber remaining items
            renumberItems();
            updateRemoveButtons();
        }

        // Update options dropdown when product is selected
        function updateOptions(selectElement) {
            const productValue = selectElement.value;
            const productItem = selectElement.closest('.product-item');
            const optionSelect = productItem.querySelector('.option-select');

            // Clear existing options
            optionSelect.innerHTML = '';

            if (productValue && productOptionsData[productValue]) {
                // Enable and populate options
                optionSelect.disabled = false;

                // Add default option
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                optionSelect.appendChild(defaultOption);

                // Add product-specific options
                productOptionsData[productValue].forEach(option => {
                    const optElement = document.createElement('option');
                    optElement.value = option;
                    optElement.textContent = option;
                    optionSelect.appendChild(optElement);
                });
            } else {
                // Disable and show placeholder
                optionSelect.disabled = true;
                const placeholderOption = document.createElement('option');
                placeholderOption.value = '';
                placeholderOption.textContent = 'ì œí’ˆì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”';
                optionSelect.appendChild(placeholderOption);
            }
        }

        // Renumber all items after deletion
        function renumberItems() {
            const items = document.querySelectorAll('.product-item');
            items.forEach((item, index) => {
                const heading = item.querySelector('h3');
                heading.textContent = `í•­ëª© ${index + 1}`;
            });
            productItemCounter = items.length;
        }

        // Show/hide remove buttons based on item count
        function updateRemoveButtons() {
            const items = document.querySelectorAll('.product-item');
            const removeButtons = document.querySelectorAll('.remove-btn');

            if (items.length === 1) {
                // Hide remove button when only 1 item
                removeButtons.forEach(btn => btn.classList.add('hidden'));
            } else {
                // Show all remove buttons when 2+ items
                removeButtons.forEach(btn => btn.classList.remove('hidden'));
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateRemoveButtons();
        });
    </script>
</body>
</html>
